---
doc_type: feature_spec
id: F-003.05
name: Helper Signing Identity and Launch Constraints
status: active
owner: dshakiba
parent: F-003
children: []
aliases:
  - Launch Constraint Stability
version: 1.1.0
last_reviewed: 2026-02-19
tags:
  - signing
  - launchd
  - security
risk_level: high
dependencies:
  - F-003
  - F-003.04
  - F-006
---

# [F-003.05] Helper Signing Identity and Launch Constraints

## Summary

Stabilize privileged helper launch eligibility by enforcing a deterministic helper signing identifier and preserving launch-constraint-compatible signing metadata in release builds.

## Goals

- Prevent launchd launch-constraint failures caused by helper identifier drift.
- Keep helper signing identity explicit and traceable in build settings and runtime constants.
- Ensure app-side XPC requirement setup remains performant during repeated helper probes.

## Non-Goals

- Replacing SMAppService registration flow.
- Broad changes to helper command surface or daemon protocol.

## Requirements

- R1: Helper release builds must be signed with identifier `com.dshakiba.AwakeBar.PrivilegedHelper`.
- R2: Helper build settings must embed Info.plist metadata in the executable so code-signing identity stays bound to bundle metadata.
- R3: App-side helper code-signing requirement must be deterministic from shared identifier constants plus configured team ID (no runtime helper-binary requirement parsing).
- R4: Smoke checks must verify helper identifier, mach service, and team consistency for built and installed app artifacts.
- R5: Setup flow must avoid automatic unregister/register repair loops when helper launch remains unreachable, and surface deterministic recovery guidance.

<!-- AUTOGEN:REQUIREMENTS_CHECKLIST -->
- [x] R1
- [x] R2
- [x] R3
- [x] R4
- [x] R5

## Acceptance Criteria

- AC1: Release artifacts report helper identifier `com.dshakiba.AwakeBar.PrivilegedHelper` in `codesign` output.
- AC2: Unit tests enforce identifier contract constants used by runtime signing checks.
- AC3: Smoke-check script fails when helper signing identifier deviates from shared constants.
- AC4: Setup tests prove helper-unreachable paths do not call unregister/register repair loops.

<!-- AUTOGEN:ACCEPTANCE_CHECKLIST -->
- [x] AC1
- [x] AC2
- [x] AC3
- [x] AC4

## Traceability

<!-- AUTOGEN:TRACEABILITY -->
| Item | Type | Evidence |
|---|---|---|
| R1 | code | project.yml |
| R1 | code | AwakeBarShared/PrivilegedServiceConstants.swift |
| R2 | code | project.yml |
| R3 | code | AwakeBar/Services/PrivilegedDaemonClient.swift |
| R4 | code | Scripts/smoke-check-app.sh |
| R5 | code | AwakeBar/Services/ClosedLidSetupController.swift |
| AC1 | manual | Release build `codesign -dv` verification |
| AC2 | test | AwakeBarTests/PrivilegedDaemonClientTests.swift |
| AC2 | test | AwakeBarTests/PrivilegedServiceContractTests.swift |
| AC3 | code | Scripts/smoke-check-app.sh |
| AC4 | test | AwakeBarTests/ClosedLidSetupControllerTests.swift |

## Children

<!-- AUTOGEN:CHILDREN -->
- None

## References

<!-- AUTOGEN:REFERENCES -->
- [F-003](./F-003-closed-lid-admin-control.md)
- [F-003.04](./F-003.04-helper-packaging-launchd.md)
- [F-006](./F-006-signed-release-notarization.md)

## API Contract

<!-- AUTOGEN:API_CONTRACT_SUMMARY -->
- `PrivilegedServiceConstants.helperCodeSigningIdentifier`
- `CodeSigningRequirementBuilder.requirement(for:teamID:)`
- `CodeSigningRequirementBuilder.configuredTeamID(from:)`
- `PrivilegedDaemonClient.makeConnection()`

## Impact

<!-- AUTOGEN:IMPACT_MAP -->
- Removes a class of launchd helper spawn failures tied to helper signing identity mismatch.
- Keeps helper request paths free of runtime Security requirement parsing.
- Reduces setup-time churn by preventing repeated SMAppService unregister/register loops on launch-constraint failures.

## Security

<!-- AUTOGEN:SECURITY_CHECKLIST -->
- [x] Helper identity is explicit and team-bound in release signatures
- [x] Runtime XPC connection enforces helper code-signing requirement

## Budget

<!-- AUTOGEN:BUDGET_CHECKLIST -->
- [x] Helper requirement setup is constant-time from shared metadata
- [x] Packaging verification remains script-based and fast for CI/local release checks

## Table of Contents

<!-- AUTOGEN:TOC -->
- Summary
- Goals
- Non-Goals
- Requirements
- Acceptance Criteria

<!-- DO NOT EDIT BELOW (AUTOGENERATED) -->

## Changelog

- 2026-02-19: Initial child spec created to track helper signing identity stability and launch-constraint compatibility.
- 2026-02-19: Added no-repair-loop setup requirement and regression tests for launch-unreachable helper states.
