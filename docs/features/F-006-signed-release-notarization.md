---
doc_type: feature_spec
id: F-006
name: Signed Release and Notarization
status: active
owner: dshakiba
parent: null
children:
  - F-006.01
  - F-006.02
aliases:
  - Distribution Pipeline
version: 1.2.0
last_reviewed: 2026-02-19
tags:
  - release
  - signing
  - notarization
risk_level: high
dependencies:
  - F-003
---

# [F-006] Signed Release and Notarization

## Summary

Produce distributable macOS builds through a signed, notarized, and checksumed release pipeline with local and CI execution paths.

## Goals

- Ensure release artifacts are signed and notarized before distribution.
- Keep local and CI release flows aligned.
- Preserve code-signing team identity required by privileged XPC trust checks.

## Non-Goals

- Auto-updater delivery channel.
- Windows/Linux packaging.

## Requirements

- R1: Local release flow must archive, sign, notarize, staple, and zip the app with SHA-256 output.
- R2: CI release flow must run equivalent signing/notarization steps on version tags.
- R3: Both local and CI flows must inject `AWAKEBAR_TEAM_ID` from Apple team identity.
- R4: Release outputs must be publishable artifacts (`.zip` + `.sha256`).
- R5: Release flows must reject wrong signing identity type before archive and keep secret material scoped to ephemeral keychain/files.
- R6: Hosted release publication must remain tag-scoped; manual workflow runs may validate pipeline but must not publish non-tag releases.
- R7: Release archives must enable Hardened Runtime for app and embedded helper binaries so notarization accepts artifacts.

<!-- AUTOGEN:REQUIREMENTS_CHECKLIST -->
- [x] R1
- [x] R2
- [x] R3
- [x] R4
- [x] R5
- [x] R6
- [x] R7

## Acceptance Criteria

- AC1: Local release script exits early when required secrets are missing.
- AC2: CI workflow publishes stapled ZIP + checksum on `v*` tags.
- AC3: Team-bound signing identity is propagated to app/helper builds.
- AC4: Both local and CI flows fail early when Developer ID identity or notarization credentials are invalid.
- AC5: CI release publication is guarded to `refs/tags/v*` only.
- AC6: Local release notarization submissions are accepted by Apple without hardened-runtime validation errors.

<!-- AUTOGEN:ACCEPTANCE_CHECKLIST -->
- [x] AC1
- [x] AC2
- [x] AC3
- [x] AC4
- [x] AC5
- [x] AC6

## Traceability

<!-- AUTOGEN:TRACEABILITY -->
| Item | Type | Evidence |
|---|---|---|
| R1 | code | Scripts/release-notarize.sh |
| R2 | code | .github/workflows/release-macos.yml |
| R3 | code | Scripts/release-notarize.sh |
| R3 | code | .github/workflows/release-macos.yml |
| R4 | code | Scripts/release-notarize.sh |
| R4 | code | .github/workflows/release-macos.yml |
| R5 | code | Scripts/release-notarize.sh |
| R5 | code | .github/workflows/release-macos.yml |
| R6 | code | .github/workflows/release-macos.yml |
| R7 | code | project.yml |
| AC1 | code | Scripts/release-notarize.sh |
| AC2 | code | .github/workflows/release-macos.yml |
| AC3 | code | project.yml |
| AC4 | code | Scripts/release-notarize.sh |
| AC4 | code | .github/workflows/release-macos.yml |
| AC5 | code | .github/workflows/release-macos.yml |
| AC6 | manual | Local notarization run 2026-02-18 |

## Children

<!-- AUTOGEN:CHILDREN -->
- [F-006.01](./F-006.01-local-notarization-script.md)
- [F-006.02](./F-006.02-ci-release-workflow.md)

## References

<!-- AUTOGEN:REFERENCES -->
- [F-003](./F-003-closed-lid-admin-control.md)
- [F-006.01](./F-006.01-local-notarization-script.md)
- [F-006.02](./F-006.02-ci-release-workflow.md)
- [ADR-0001](../DECISIONS/ADR-0001-privileged-daemon-cutover.md)

## API Contract

<!-- AUTOGEN:API_CONTRACT_SUMMARY -->
- `Scripts/release-notarize.sh`
- `.github/workflows/release-macos.yml`

## Impact

<!-- AUTOGEN:IMPACT_MAP -->
- Governs trust chain for shipping privileged helper-enabled builds.
- Ensures release artifacts are reproducible and verifiable.

## Security

<!-- AUTOGEN:SECURITY_CHECKLIST -->
- [x] Uses Apple notarization and Developer ID signing
- [x] Requires explicit secrets for signing credentials
- [x] Preserves team ID consistency for XPC code-sign checks
- [x] Enforces cert-type preflight and ephemeral secret handling in release tooling
- [x] Requires Hardened Runtime on release binaries for notarization compliance

## Budget

<!-- AUTOGEN:BUDGET_CHECKLIST -->
- [x] CI cost bounded to tag-triggered release builds
- [x] Local release script is single-pass and deterministic per input

## Table of Contents

<!-- AUTOGEN:TOC -->
- Summary
- Goals
- Non-Goals
- Requirements
- Acceptance Criteria

<!-- DO NOT EDIT BELOW (AUTOGENERATED) -->

## Changelog

- 2026-02-18: Initial spec created from local/CI release pipeline implementation.
- 2026-02-19: Added release credential-preflight and secret-material handling requirements.
- 2026-02-19: Added tag-only publication guard requirement for manual workflow runs.
- 2026-02-19: Added hardened-runtime notarization acceptance requirement with local execution evidence.
