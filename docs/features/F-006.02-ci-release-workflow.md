---
doc_type: feature_spec
id: F-006.02
name: GitHub Actions Release Workflow
status: active
owner: dshakiba
parent: F-006
children: []
aliases:
  - release-macos.yml
version: 1.2.0
last_reviewed: 2026-02-19
tags:
  - ci
  - release
risk_level: high
dependencies:
  - F-006
---

# [F-006.02] GitHub Actions Release Workflow

## Summary

Automate signed notarized release asset generation and publication on version-tag pushes.

## Goals

- Provide repeatable release packaging in CI.
- Publish binary artifacts with checksum.
- Mirror local release safeguards in hosted pipeline.

## Non-Goals

- Triggering releases from branch pushes.
- In-workflow semantic version generation.

## Requirements

- R1: Workflow must trigger on pushed tags matching `v*` and support manual `workflow_dispatch` invocation.
- R2: Workflow must prepare keychain, signing cert, and App Store Connect key from secrets while keeping runner login keychain trust roots visible.
- R3: Workflow must archive release build with `AWAKEBAR_TEAM_ID` propagated from `APPLE_TEAM_ID` and hardened runtime enabled binaries.
- R4: Workflow must notarize, staple, package ZIP and checksum, then publish them as GitHub Release assets.
- R5: Workflow must fail before archive when `Developer ID Application` identity or notary credentials are invalid.
- R6: Workflow must only publish release assets for `refs/tags/v*` and clean temporary runner signing files/keychain on completion.

<!-- AUTOGEN:REQUIREMENTS_CHECKLIST -->
- [x] R1
- [x] R2
- [x] R3
- [x] R4
- [x] R5
- [x] R6

## Acceptance Criteria

- AC1: Workflow produces `build/AwakeBar-macos.zip` and `build/AwakeBar-macos.zip.sha256` artifacts.
- AC2: `softprops/action-gh-release` step uploads generated artifacts to the tag release.
- AC3: Release job runs on `macos-14` and verifies signature before notarization.
- AC4: Credential-preflight step fails early for wrong cert type or invalid notary API credentials.
- AC5: Manual `workflow_dispatch` runs do not publish GitHub Releases when run on non-tag refs.
- AC6: Runner cleanup step executes with `if: always()` and removes temporary key/keychain files.

<!-- AUTOGEN:ACCEPTANCE_CHECKLIST -->
- [x] AC1
- [x] AC2
- [x] AC3
- [x] AC4
- [x] AC5
- [x] AC6

## Traceability

<!-- AUTOGEN:TRACEABILITY -->
| Item | Type | Evidence |
|---|---|---|
| R1 | code | .github/workflows/release-macos.yml |
| R2 | code | .github/workflows/release-macos.yml |
| R3 | code | .github/workflows/release-macos.yml |
| R3 | code | project.yml |
| R4 | code | .github/workflows/release-macos.yml |
| R5 | code | .github/workflows/release-macos.yml |
| R6 | code | .github/workflows/release-macos.yml |
| AC1 | code | .github/workflows/release-macos.yml |
| AC2 | code | .github/workflows/release-macos.yml |
| AC3 | code | .github/workflows/release-macos.yml |
| AC4 | code | .github/workflows/release-macos.yml |
| AC5 | code | .github/workflows/release-macos.yml |
| AC6 | code | .github/workflows/release-macos.yml |

## Children

<!-- AUTOGEN:CHILDREN -->
- None

## References

<!-- AUTOGEN:REFERENCES -->
- [F-006](./F-006-signed-release-notarization.md)
- [F-003](./F-003-closed-lid-admin-control.md)

## API Contract

<!-- AUTOGEN:API_CONTRACT_SUMMARY -->
- `.github/workflows/release-macos.yml`

## Impact

<!-- AUTOGEN:IMPACT_MAP -->
- Produces release artifacts for end-user distribution with signing and notarization guarantees.

## Security

<!-- AUTOGEN:SECURITY_CHECKLIST -->
- [x] Secret-scoped signing inputs
- [x] Signature verification before notarization submit
- [x] Preserves login keychain trust roots during temporary signing keychain usage
- [x] Artifact checksum generation
- [x] Cert and notary credential preflight before archive
- [x] Cleanup of temporary signing files in CI runner

## Budget

<!-- AUTOGEN:BUDGET_CHECKLIST -->
- [x] Executes only on tag-based release events

## Table of Contents

<!-- AUTOGEN:TOC -->
- Summary
- Goals
- Non-Goals
- Requirements
- Acceptance Criteria

<!-- DO NOT EDIT BELOW (AUTOGENERATED) -->

## Changelog

- 2026-02-18: Initial child spec created.
- 2026-02-19: Added workflow-dispatch trigger and credential-preflight requirements.
- 2026-02-19: Added tag-only publish guard and runner cleanup requirement.
- 2026-02-19: Added keychain trust-root visibility and hardened-runtime release coverage.
