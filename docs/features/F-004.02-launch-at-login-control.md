---
doc_type: feature_spec
id: F-004.02
name: Launch-at-Login Control
status: active
owner: dshakiba
parent: F-004
children: []
aliases:
  - Login Item Toggle
version: 1.0.0
last_reviewed: 2026-02-18
tags:
  - login-item
  - service-management
risk_level: low
dependencies:
  - F-004
  - F-002
---

# [F-004.02] Launch-at-Login Control

## Summary

Manage main app login item registration through `SMAppService.mainApp` via controller-level toggle APIs.

## Goals

- Keep login item setting user-controlled.
- Avoid duplicate register/unregister calls.
- Persist user preference across launches.

## Non-Goals

- Managing helper-daemon registration (covered by closed-lid setup flow).

## Requirements

- R1: Enabling launch-at-login must register main app only when current status is not already enabled.
- R2: Disabling launch-at-login must unregister main app only when status is enabled.
- R3: Menu controller must persist login preference after successful toggle.

<!-- AUTOGEN:REQUIREMENTS_CHECKLIST -->
- [x] R1
- [x] R2
- [x] R3

## Acceptance Criteria

- AC1: Launch-at-login controller toggle emits expected controller calls and persisted preference values.
- AC2: `readEnabled()` reports current `SMAppService.mainApp.status`.

<!-- AUTOGEN:ACCEPTANCE_CHECKLIST -->
- [x] AC1
- [x] AC2

## Traceability

<!-- AUTOGEN:TRACEABILITY -->
| Item | Type | Evidence |
|---|---|---|
| R1 | code | AwakeBar/Services/LoginItemController.swift |
| R2 | code | AwakeBar/Services/LoginItemController.swift |
| R3 | code | AwakeBar/App/MenuBarController.swift |
| AC1 | test | AwakeBarTests/MenuBarControllerTests.swift |
| AC2 | code | AwakeBar/Services/LoginItemController.swift |

## Children

<!-- AUTOGEN:CHILDREN -->
- None

## References

<!-- AUTOGEN:REFERENCES -->
- [F-004](./F-004-state-persistence-login.md)
- [F-002](./F-002-menu-bar-experience.md)

## API Contract

<!-- AUTOGEN:API_CONTRACT_SUMMARY -->
- `LoginItemControlling.setEnabled(_:)`
- `LoginItemControlling.readEnabled()`

## Impact

<!-- AUTOGEN:IMPACT_MAP -->
- Determines whether AwakeBar auto-starts after user login.

## Security

<!-- AUTOGEN:SECURITY_CHECKLIST -->
- [x] Uses OS-managed login item registration API
- [x] No credential persistence

## Budget

<!-- AUTOGEN:BUDGET_CHECKLIST -->
- [x] Constant-time registration status check and update calls

## Table of Contents

<!-- AUTOGEN:TOC -->
- Summary
- Goals
- Non-Goals
- Requirements
- Acceptance Criteria

<!-- DO NOT EDIT BELOW (AUTOGENERATED) -->

## Changelog

- 2026-02-18: Initial child spec created.
- 2026-02-18: Clarified controller-level launch-at-login control wording.
